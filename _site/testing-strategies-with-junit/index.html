<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing strategies with JUnit &mdash; Simple, Not Easy</title>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,700|Oswald" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/logo.jpg"/>
    <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="Simple, Not Easy" />
    <meta name="title" content="Testing strategies with JUnit ">
    <link rel="canonical" href="/testing-strategies-with-junit">
     
    <link rel="author" href="https://plus.google.com/118230970865161551961">       
    <meta property="og:title" content="Testing strategies with JUnit "/>
    <meta property="og:url" content="/testing-strategies-with-junit"/>
    
    
    <meta property="og:description" content="In order to do unit testing easier, one should keep a word in mind: Isolation. Try your best to isolate the irrelevant things from your class, and make them easy to config."/>
    <meta name="description" content="In order to do unit testing easier, one should keep a word in mind: Isolation. Try your best to isolate the irrelevant things from your class, and make them easy to config."/>
    
    <meta property="og:site_name" content="Simple, Not Easy">     
</head>
<body>
    
<section class="site-nav">
    <header>
        <nav id="navigation" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
            <a class="brand" href="/">
                <img src="/images/logo.jpg" alt="Inc">
            </a>
            <a href="/">Blog</a>
            
              <a href="/archives.html" >Archives</a>
            
              <a href="/about.html" >About</a>
            
              <a href="/tags.html" >Tags</a>
            
              <a href="http://cast.allenlsy.com" >Casts</a>
            
            <i class="icon-feed"></i> <a href="/feed.xml" title="Atom/RSS feed">Feed</a>
        </nav>

    </header>
</section>


<article>

    <div class="container">
        <header>
            <h1 class="title">Testing strategies with JUnit</h1>
            
            <div class="meta">
                <time pubdate datetime="2013-29-January" title="January 29, 2013">January 29, 2013</time>
            </div>
            <div class="tags">
              <a href="/tags/testing.html" rel="tag">testing</a> <a href="/tags/java.html" rel="tag">java</a>
            </div>
            <div class="hidden-seo">
              By <a href="/testing-strategies-with-junit" title="Testing strategies with JUnit" rel="author">allenlsy</a>
            </div>
        </header>

        <section>
            <ul>
  <li><a href="#i1">How To Write Testable Code</a></li>
  <li><a href="#i2">Several Words About TDD</a></li>
  <li><a href="#i3">Stubs and Mocks</a></li>
  <li><a href="#i4">Inverse of Control</a></li>
  <li><a href="#i5">In-Container Testing</a></li>
</ul>

<p>In order to do unit testing easier, one should keep a word in mind: Isolation. Try your best to isolate the irrelevant things from your class, and make them easy to config.</p>

<h2 id="i1">How To Write Testable Code</h2>

<p>There are some common rules to write testable code.</p>

<h4 id="never-change-the-signature-of-a-public-method">* Never change the signature of a public method</h4>

<p>If you change the signature of a public method, then you need to change every call to site in the application and unit tests. In the open source world, and for any API made public by a commercial product, life can get even more complicated — many people use your code, you should make it backward compatible.</p>

<h4 id="reduce-dependencies">* Reduce Dependencies</h4>

<p>Unit tests verify your code in isolation. Your unit tests should instantiate the class you want to test, use it, and assert its correctness. Do not instantiate other classes.</p>

<h4 id="create-simple-constructors">* Create Simple Constructors</h4>

<p>When testing, there are something we need to do:</p>

<ul>
  <li>Instantiate the class to test</li>
  <li>Set the calss into a particular state</li>
  <li>Assert the final state of the class</li>
</ul>

<p>With complicated construcotr, we might mix the first and second points. This code is hard to maintain and test.</p>

<h4 id="law-of-demeter">* Law of Demeter</h4>

<p>Also known as the Least Knowledge principle: one class should know only as much as it needs to know.</p>

<p>Consider the following code:</p>

<div class="highlight"><pre><code class="java"><span class="kd">class</span> <span class="nc">Car</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Driver</span> <span class="n">driver</span><span class="o">;</span>
    
    <span class="n">Car</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">driver</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getDriver</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<p><code>Car</code> should not know the <code>Context</code> object.</p>

<p>Here is a recommended solution</p>

<div class="highlight"><pre><code class="java"><span class="n">Car</span><span class="o">(</span><span class="n">Driver</span> <span class="n">driver</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">driver</span> <span class="o">=</span> <span class="n">driver</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div>

<h4 id="avoid-hidden-dependendcis-and-global-state">* Avoid hidden dependendcis and global state</h4>

<p>Global state makes it possible for many clients to share the global object.</p>

<p>See the following code:</p>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">reserver</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">DBManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DBManager</span><span class="o">();</span>
    <span class="n">manager</span><span class="o">.</span><span class="na">initDatabase</span><span class="o">();</span>
    <span class="n">Reservation</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Reservation</span><span class="o">();</span>
    <span class="n">r</span><span class="o">.</span><span class="na">reserve</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>

<p>The <code>DBManager</code> implies a global state. And the <code>Reservation</code> class hides its dependency on the database manager from the programmer because the PAI doesn’t give us a clue.</p>

<p>Here is a better implementation</p>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">reserver</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">DBManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DBManager</span><span class="o">();</span>
    <span class="n">manager</span><span class="o">.</span><span class="na">initDatabase</span><span class="o">();</span>
    <span class="n">Reservation</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Reservation</span><span class="o">(</span><span class="n">manager</span><span class="o">);</span>
    <span class="n">r</span><span class="o">.</span><span class="na">reserve</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>

<p>Here, the <code>Reservation</code> object should be able to function only if it has been configured with a database manager.</p>

<h4 id="favor-generic-methods">* Favor Generic Methods</h4>

<p>In order to achive isolation in testing, you need some articulation points in your code, where you can easily substitute your code with the test code. With polymorphism, the moethod you’re calling can be determined at runtime. Static method does not have polymorphism, sometimes makes testing difficult.</p>

<h4 id="faver-composition-over-inheritance">* Faver composition over inheritance</h4>

<h4 id="faver-polymorphism-over-conditionals">* Faver polymorphism over conditionals</h4>

<h2 id="i2">Several Words about TDD</h2>

<p>TDD, Test-Driven-Development, let the tests to drive you do programming. Someone says that there are two phases in TDD, someone says three. It doesn’t matter much.</p>

<p>I mainly agree with the three-phases opinion. They are:</p>

<ul>
  <li>Fail the test</li>
  <li>Implement and Pass the test</li>
  <li>Refactor</li>
</ul>

<p>Refactor is optional sometimes.</p>

<h2 id="i3">Stubs and Mocks</h2>

<p><code>Stub</code>: Suppose you are development a complicated system. When the class or module is not fully implemented but you still want to test it, you can extends the existing class, and make the un-finished part working by just put in simple logic. For instance, if a method should query data from the database but it is not implemented, then you can stub it, make it return some values. Stubs does not change the existing code, but instead adapt to provide seamless integration. Stub is always used for coarse-grained software test, like integration test.</p>

<p><code>Mock</code>: fully fake class or module. It never has real business logic, just return values. It is very similar to stub. But only stubs is a extending the existing code, may contain real business logic, but mock does not have any real business logic. It is a brand new fake module.</p>

<p><strong>Talking about flexibility</strong>: someone may feel troublesome to write tests. Well, if your code is too inflexible for some tests to use, then your code is really inflexible, and you should redesign it.</p>

<p>In mocking techniques, sometimes we want to verify that a method has been called exactly some times. This is called expectation. Many mocking frameworks, like easymock, do provide the expectation functionality.</p>

<h4 id="comparison">Comparison</h4>

<p>Stub often requires less code than mock. But mocks are always running faster, especially if the function need to connect to database or depends on network connection.</p>

<h2 id="i4">Inversion of Control</h2>

<p>Talking again about IoC, that is what I mentioned at the beginning of this article. Traditionally In a class, say A, if we want to create an object B, which is an instance of another class, we just create it in A. But from the testing point of view, if we are writing unit test for A, then the correctness of test depends on the correctness of B, since the creation of B is inside A. To remove this dependency, that’s why we need to inverse the creation(control) of B to outside of A. We may pass the created object B to class A or whatever. There are many good IoC containers in the market. Most famous is Spring. Guice is very popular these days.</p>

<h2 id="i5">In-Container Testing</h2>

<p>Stubs and Mocks are both Out-Container Testing techniques. In-Container testing means that the object being tested must live in a environment, we call it container. For example, to test <code>SampleServlet</code>, it should be run with <code>HttpServletRequest</code> and <code>HttpSession</code>. Maybe it need live data. So it is the testing inside the container, like Tomcat.</p>

<p>This will be discussed in more details in the future.</p>

            
<div class="social">
    <div>
        <a href="https://twitter.com/share" class="twitter-share-button"  data-text="Testing strategies with JUnit" data-related="allenlsy">Tweet</a>
    </div>
    
    
    <div>
        <div class="fb-like" data-width="150" data-layout="button_count" data-action="like" data-show-faces="true" data-send="false"></div>
    </div>
    
    
    <div>
        <div class="g-plusone" data-size="medium"></div>
    </div>
    
    
    
    <div>
        <a href="http://news.ycombinator.com/submit" class="hn-share-button">Vote on HN</a>
    </div>
    
</div>

        </section>
        
        <section>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'allenlsy'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
        </section>
        
    </div>
</article>


<footer class="site-footer">
    <div class="container">
      &copy; 2013 &nbsp;  
        
        <nav>
            <a href="http://allenlsy.com">Blog</a> &middot;
            <a href="http://cast.allenlsy.com">Casts</a> &middot;
            
            
        </nav>
        
        <nav class="social">
            
            <a href="https://twitter.com/allenlsy" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter black"></i></a>
            
            
            <a href="http://facebook.com/allenlsy" title="Follow on Facebook" target="_blank"><i class="icon icon-facebook black"></i></a>
                
            <a href="/feed.xml" title="RSS Feed">
                <i class="icon icon-rss black"></i>
            </a>
        </nav>
    </div>
</footer>

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/assets/main.js"></script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=253595308025739";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<script>
    (function(d, t) {
        var g = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        g.src = '//hnbutton.appspot.com/static/hn.min.js';
        s.parentNode.insertBefore(g, s);
    }(document, 'script'));
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-24647338-1', '');
  ga('send', 'pageview');
</script>

</body>
</html>
