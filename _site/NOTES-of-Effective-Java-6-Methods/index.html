<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Effective Java 6 - Methods &mdash; Simple, Not Easy</title>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,700|Oswald" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/logo.jpg"/>
    <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="Simple, Not Easy" />
    <meta name="title" content="Effective Java 6 - Methods ">
    <link rel="canonical" href="/NOTES-of-Effective-Java-6-Methods">
    
    <link rel="author" href="https://plus.google.com/118230970865161551961">
    <meta property="og:title" content="Effective Java 6 - Methods "/>
    <meta property="og:url" content="/NOTES-of-Effective-Java-6-Methods"/>
    
    
    <meta property="og:site_name" content="Simple, Not Easy">
    <link rel="stylesheet" href="/bt-responsive.css" type="text/css" media="screen" charset="utf-8">
    <meta name="keywords" content="java">
</head>
<body>

<section class="site-nav">
    <header>
        <nav id="navigation" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
            <a class="brand" href="/">
                <img src="/images/logo.jpg" alt="Inc">
            </a>
            <a href="/">Blog</a>
            
              <a href="/archives.html" >Archives</a>
            
              <a href="/about.html" >About</a>
            
              <a href="/tags.html" >Tags</a>
            
              <a href="http://cast.allenlsy.com" >Casts</a>
            
            <i class="icon-feed"></i> <a href="/feed.xml" title="Atom/RSS feed">Feed</a>
        </nav>

    </header>
</section>


<article>

    <div class="container">
        <header>
            <h1 class="title">Effective Java 6 - Methods</h1>
            
            <div class="meta">
                <time pubdate datetime="2013-15-May" title="May 15, 2013">May 15, 2013</time>
            </div>
            <div class="tags">
              <a href="/tags/java.html" rel="tag">java</a>
            </div>
            <div class="hidden-seo">
              By <a href="/NOTES-of-Effective-Java-6-Methods" title="Effective Java 6 - Methods" rel="author">allenlsy</a>
            </div>
        </header>

        <section>
            <p><img src="http://www.crazysmoove.com/memjug/javabooks-slides/images/Effective_Java.jpg" alt="1" />
<br /></p>

<ul>
  <li><a href="#i38">38. Parameter validation</a></li>
  <li><a href="#i39">39. Make defensive copies when needed</a></li>
  <li><a href="#i40">40. Design method signatures carefully</a></li>
  <li><a href="#i41">41. Use overloading judiciously</a></li>
  <li><a href="#i42">42. Use varargs judiciously</a></li>
  <li><a href="#i43">43. Return empty arrays or collections, not nulls</a></li>
  <li><a href="#i44">44. Write doc comments for all exposed API elements</a></li>
</ul>

<hr />

<h2 id="i38">38. Parameter validation</h2>

<p>If parameter is not valid, a method should throw exceptions, other than continuing the method and return wrong result. Common exceptions are <code>IllegalArgumentException</code>, <code>IndexOutOfBoundsException</code>, <code>NullPointerException</code>.</p>

<p>For unexported method(such as private method), usually we use assertion to check their parameters</p>

<div class="highlight"><pre><code class="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sort</span><span class="o">(</span><span class="kt">long</span> <span class="n">a</span><span class="o">[],</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">assert</span> <span class="n">a</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
	<span class="k">assert</span> <span class="n">offset</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">offset</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
	<span class="k">assert</span> <span class="n">length</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">length</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="n">offset</span><span class="o">;</span>
	<span class="c1">// ...</span>

<span class="o">}</span>
</code></pre></div>

<p>If assertion failed, then program will throw <code>AssertionError</code>.</p>

<p>If the validation is costly, then validation can be performed implicitly in the process of doing the computation.</p>

<p>If there is exception during computation and the program throws another type of exception due to invalid parameter, we should use <strong>exception translation</strong>.</p>

<h2 id="i39">39. Make defensive copies when needed</h2>

<p>You must program defensively, with the assumption that clients of your class will do their best to destroy its invariants.</p>

<p>More likely, your class will have to cope with unexpected behavior resulting from honest mistakes on the part of programmers using your API.</p>

<h4 id="example">Example</h4>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Period</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="nf">Period</span><span class="o">(</span><span class="n">Date</span> <span class="n">start</span><span class="o">,</span> <span class="n">Date</span> <span class="n">end</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span><span class="o">(</span><span class="n">start</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">end</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span> <span class="n">start</span> <span class="o">+</span> <span class="s">&quot; after &quot;</span> <span class="o">+</span> <span class="n">end</span><span class="o">);</span>
		<span class="k">this</span><span class="o">.</span><span class="na">start</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">end</span> <span class="o">=</span> <span class="n">end</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Date</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">start</span><span class="o">;</span>

	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Date</span> <span class="nf">end</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">end</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="c1">// ...</span>
<span class="o">}</span>

<span class="n">Date</span> <span class="n">start</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
<span class="n">Date</span> <span class="n">end</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
<span class="n">Period</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Period</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">);</span>
<span class="n">end</span><span class="o">.</span><span class="na">setYear</span><span class="o">(</span><span class="mi">78</span><span class="o">);</span> <span class="c1">// modifies internals of p</span>
</code></pre></div>

<p>To protect the <code>Period</code> instance internals, we need to make <strong>defensive copy</strong> for every variant parameter.</p>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="nf">Period</span><span class="o">(</span><span class="n">Date</span> <span class="n">start</span><span class="o">,</span> <span class="n">Date</span> <span class="n">end</span><span class="o">)</span>
<span class="o">{</span>
	<span class="k">this</span><span class="o">.</span><span class="na">start</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="n">start</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
	<span class="k">this</span><span class="o">.</span><span class="na">end</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="n">end</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>

	<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">start</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">end</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
		<span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span> <span class="n">start</span> <span class="o">+</span> <span class="s">&quot; after &quot;</span> <span class="o">+</span> <span class="n">end</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></div>

<p><strong>The defensive copy is before the parameter validation, and the validation is for the defensive copy, not the original parameters.</strong></p>

<p>Don’t use the <code>clone</code> method to make a defensive copy of a parameter whose type is subclassable by untrusted parties.</p>

<p>Another way to attack is:</p>

<div class="highlight"><pre><code class="java"><span class="n">Period</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Period</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">);</span>
<span class="n">p</span><span class="o">.</span><span class="na">end</span><span class="o">().</span><span class="na">setYear</span><span class="o">(</span><span class="mi">78</span><span class="o">);</span>
</code></pre></div>

<p>To defend, return a copy of internal object:</p>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="n">Date</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">(</span><span class="n">start</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="n">Date</span> <span class="nf">end</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">(</span><span class="n">end</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div>

<p>Use immutable objects as components of your objects,</p>

<p>If the class trust the caller of the class will not modify the internals, then no defensive copy is allowed. But it must be documented that the caller cannot modify the return value or parameter. </p>

<h2 id="i40">40. Design method signatures carefully</h2>

<ul>
  <li>Choose method names carefully</li>
  <li>Don’t go overboard in providing convenience methods. Too many methods makes a class complex.</li>
  <li>Avoid long parameter list</li>
  <li>Prefer two-element enum types to <code>boolean</code> parameters</li>
</ul>

<h2 id="i41">41. Use overloading judiciously</h2>

<h4 id="example-check-the-type-of-collection">Example: check the type of <code>Collection</code>:</h4>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CollectionClassifier</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">classify</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span> <span class="o">?</span> <span class="o">&gt;</span> <span class="n">s</span><span class="o">){</span>
		<span class="k">return</span> <span class="s">&quot;Set&quot;</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">classify</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span> <span class="o">?</span> <span class="o">&gt;</span> <span class="n">s</span><span class="o">){</span>
		<span class="k">return</span> <span class="s">&quot;List&quot;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">classify</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span> <span class="o">?</span> <span class="o">&gt;</span> <span class="n">s</span><span class="o">){</span>
		<span class="k">return</span> <span class="s">&quot;Unknown Collection&quot;</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">Collection</span><span class="o">&lt;</span> <span class="o">?</span> <span class="o">&gt;[]</span> <span class="n">collections</span> <span class="o">=</span> <span class="o">{</span>
			<span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span> <span class="n">String</span> <span class="o">&gt;(),</span>
			<span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span> <span class="n">BigInteger</span> <span class="o">&gt;(),</span>
			<span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;().</span><span class="na">values</span><span class="o">()</span>
		<span class="o">};</span>

		<span class="k">for</span> <span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span> <span class="o">?</span> <span class="o">&gt;</span> <span class="n">c</span> <span class="o">:</span> <span class="n">collections</span><span class="o">)</span> 
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">classify</span><span class="o">(</span><span class="n">c</span><span class="o">));</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<p>The output will be three <code>Unknown Collection</code>. Because in the for-loop, all the elements are compiled to be <code>Collection&lt;?&gt;</code>. Overloading will not dynamicly choose the right method like overriding does.</p>

<p>The correct way is:</p>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">classify</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span> <span class="o">?</span> <span class="o">&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">return</span> <span class="n">c</span> <span class="k">instanceof</span> <span class="n">Set</span> <span class="o">?</span> <span class="s">&quot;Set&quot;</span> <span class="o">:</span> <span class="n">c</span> <span class="k">instanceof</span> <span class="n">List</span> <span class="o">?</span> <span class="s">&quot;List&quot;</span> <span class="o">:</span> <span class="s">&quot;Unknown Collection&quot;</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div>

<p>Better strategy to use overloading is never to export two overloadings with the same number of parameters. If a method uses varargs, not to overload it at all.</p>

<p>For example, int <code>ObjectOutputStream</code> class, the <code>write</code> method has many different expressions, such as <code>writeBoolean</code> and <code>writeInt</code>.</p>

<h4 id="example-1">Example</h4>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">Test</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">List</span><span class="o">&lt;</span> <span class="n">Integer</span> <span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span> <span class="n">Integer</span> <span class="o">&gt;();</span>

		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> 
			<span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
		
		<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
			<span class="n">list</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>

		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<p>The output is <code>[-2, 0, 2]</code>. <code>remove(int)</code> in <code>List</code> will remove the element at given position. To remove first appearing element, use <code>remove(E)</code>, which should be <code>remove((Integer) i)</code> here.</p>

<h2 id="i42">42. Use varargs judiciously</h2>

<p>For a method <code>void func(int... args)</code>, if user has no input, it will fail at runtime but not compile time. One way to solve the problem is to change it to <code>void func(int firstArg, int... remainingArgs)</code>.</p>

<h4 id="example-right-way-to-print-an-array">Example: right way to print an array</h4>

<div class="highlight"><pre><code class="java"><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">ary</span><span class="o">));</span>
<span class="c1">// System.out.println(Arrays.asList(ary)); WILL NOT HAVE EXPECT OUTPUT</span>
</code></pre></div>

<h2 id="i43">43. Return empty arrays or collections, not nulls</h2>

<h2 id="i44">44. Write doc comments for all exposed API elements</h2>

<p>Java doc uses specially formated documentation comment to generate API doc.</p>

<p>Doc comments should state all the <em>preconditions</em> and <em>postconditions</em>, and also <strong>side effect</strong>. Side effect is the observable change after running this. For example, if a method starts a backend thread, then the doc should state it.</p>

<p>Some common elements in doc: <code>@param</code>, <code>@return</code>, <code>@throws</code>, html element, <code>{@code}</code> piece, <code>{@literal}</code> to avoid escaping of <code>.</code> or other characters</p>


            
<div class="social">
    <div>
        <a href="https://twitter.com/share" class="twitter-share-button"  data-text="Effective Java 6 - Methods" data-related="allenlsy">Tweet</a>
    </div>
    
    
    <div>
        <div class="fb-like" data-width="150" data-layout="button_count" data-action="like" data-show-faces="true" data-send="false"></div>
    </div>
    
    
    <div>
        <div class="g-plusone" data-size="medium"></div>
    </div>
    
    
    
    <div>
        <a href="http://news.ycombinator.com/submit" class="hn-share-button">Vote on HN</a>
    </div>
    
</div>

        </section>
        
        <section>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'allenlsy'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
        </section>
        
    </div>
</article>


<footer class="site-footer">
    <div class="container">
      copy; 2014 &nbsp; 

        <nav>
            <a href="http://allenlsy.com">Blog</a> &middot;
            <a href="http://cast.allenlsy.com">Casts</a> &middot;
            
            
        </nav>

        <nav class="social">
            
            <a href="https://twitter.com/allenlsy" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter black"></i></a>
            
            
            <a href="http://facebook.com/allenlsy" title="Follow on Facebook" target="_blank"><i class="icon icon-facebook black"></i></a>
            
            <a href="/feed.xml" title="RSS Feed">
                <i class="icon icon-rss black"></i>
            </a>
        </nav>
    </div>
</footer>

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/assets/main.js"></script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=253595308025739";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<script>
    (function(d, t) {
        var g = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        g.src = '//hnbutton.appspot.com/static/hn.min.js';
        s.parentNode.insertBefore(g, s);
    }(document, 'script'));
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-24647338-1', '');
  ga('send', 'pageview');
</script>

</body>
</html>
